# lec5 SPOC思考题


## 个人思考题
---

请简要分析最优匹配，最差匹配，最先匹配，buddy systemm分配算法的优势和劣势，并尝试提出一种更有效的连续内存分配算法 (w3l1)
```
  + 采分点：说明四种算法的优点和缺点
  - 答案没有涉及如下3点；（0分）
  - 正确描述了二种分配算法的优势和劣势（1分）
  - 正确描述了四种分配算法的优势和劣势（2分）
  - 除上述两点外，进一步描述了一种更有效的分配算法（3分）
 ```
- [x]  
最优匹配： 优点：大部分分配的尺寸较小时，效果会很好,可避免大的空闲分区被拆分,可减小外部碎片的大小,实现起来相对简单。 缺点：会产生外部碎片；释放分区时会比较慢；很容易产生很多无用的小碎片;
最差匹配： 优点：中等大小的分配较多时，效果最好；避免出现太多的小碎片; 缺点：会产生外部碎片；释放分区时会比较慢；容易破坏大的空闲分区，因此后续难以分配大的分区;
最先匹配： 优点：实现起来相对简单；在高地址空间会有大块的空闲分区 缺点：会产生外部碎片；分配大块碎片时比较慢;
buddy system分配算法： 优点：相对更小的外部碎片；释放分区时比较快 缺点：会产生外部碎片和内部碎片；分配尺寸如果大部分都是比二次幂多一点的时候效率会比较低
>  

## 小组思考题

请参考xv6（umalloc.c），ucore lab2代码，选择四种（0:最优匹配，1:最差匹配，2:最先匹配，3:buddy systemm）分配算法中的一种或多种，在Linux应用程序/库层面，用C、C++或python来实现malloc/free，给出你的设计思路，并给出可以在Linux上运行的malloc/free实现和测试用例。 (spoc)

- [基于malloc与free函数的实现代码及分析](http://www.jb51.net/article/36391.htm)

```
如何表示空闲块？ 如何表示空闲块列表？ 
[(start0, size0),(start1,size1)...]
在一次malloc后，如果根据某种顺序查找符合malloc要求的空闲块？如何把一个空闲块改变成另外一个空闲块，或消除这个空闲块？如何更新空闲块列表？
在一次free后，如何把已使用块转变成空闲块，并按照某种顺序（起始地址，块大小）插入到空闲块列表中？考虑需要合并相邻空闲块，形成更大的空闲块？
如果考虑地址对齐（比如按照4字节对齐），应该如何设计？
如果考虑空闲/使用块列表组织中有部分元数据，比如表示链接信息，如何给malloc返回有效可用的空闲块地址而不破坏
元数据信息？
伙伴分配器的一个极简实现
http://coolshell.cn/tag/buddy
```

--- 
